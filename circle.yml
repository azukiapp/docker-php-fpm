machine:
  services:
    - docker

test:
  override:

    # Create index.php that will output the `phpinfo()`.
    - docker build -t gullitmiranda/php-fpm 5.6
    - |
      mkdir src
      cat <<-EOL > src/index.php
      	<?php

      	phpinfo();

        php?>
      EOL
      cat 5.6/configuration/nginx.conf
    - |
      docker run --rm gullitmiranda/php-fpm ls -alh /var/www/public/
    - |
      docker run -d -p 80:80 \
        -v $(pwd)/5.6/configuration:/docker/configuration \
        -v $(pwd)/src:/docker/src \
        -e APP_DIR:/docker/src \
        --name php-fpm \
        gullitmiranda/php-fpm; \
      sleep 5
    - curl --retry 10 --retry-delay 5 -v http://localhost:80
    - docker logs php-fpm

# deployment:
#   hub:
#     branch: master
#     commands:

#       # Authenticate with docker and push the latest image.

#       - docker login -e $DOCKER_HUB_EMAIL -u $DOCKER_HUB_USER -p $DOCKER_HUB_PASSWORD
#       - docker push gullitmiranda/php-fpm
