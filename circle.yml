machine:
  services:
    - docker

test:
  override:

    # Create index.php that will output the `phpinfo()`.
    - docker build -t gullitmiranda/php-fpm .
    - |
      mkdir src
      cat <<-EOL > src/index.php
      	<?php

      	phpinfo();

        php?>
      EOL
      cp 5.6/configuration/nginx.conf.sample 5.6/configuration/nginx.conf
      sed -i \
        -e 's/root \/var\/www/root \/docker\/src/g' \
        5.6/configuration/nginx.conf
      cat 5.6/configuration/nginx.conf
    - |
      docker run -d -p 80:80 \
        -v $(pwd)/5.6/configuration:/docker/configuration \
        -v $(pwd)/5.6/src:/docker/src \
        --name php-fpm \
        gullitmiranda/php-fpm; \
      sleep 5
    - curl --retry 10 --retry-delay 5 -v http://localhost:80
    - docker logs php-fpm

# deployment:
#   hub:
#     branch: master
#     commands:

#       # Authenticate with docker and push the latest image.

#       - docker login -e $DOCKER_HUB_EMAIL -u $DOCKER_HUB_USER -p $DOCKER_HUB_PASSWORD
#       - docker push gullitmiranda/php-fpm
